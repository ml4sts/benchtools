# module to build benchmarks
# should create folder structure
import os
import shutil
import requests
# from pathlib import Path # ???


### Create benchmark skeleton
def build_dir(bench_path):
    
    os.mkdir(bench_path)
    # Create a benchmarks folder with tasks in them
    tasks_path = os.path.join(bench_path, "benchmarks")
    os.mkdir(tasks_path)

### Generate an about path from the description of the user 
def create_about(bench_name, bench_path, text):
    about_path = os.path.join(bench_path, "about.md")
    about_text= f"""
    # {bench_name}
    {text}

    Generated by BenchTools
    """
    with open(about_path, 'w') as file:
        file.write(about_text)

### Initialize git repository
def init_repo(bench_path):
    current_dir = os.getcwd()
    os.chdir(bench_path)
    try:
        os.system("git init . -q")
        os.system("git branch -m main")
    except:
        print("git might not be initialized in your system. Please run \"git init . \" when setup")
    # Get python gitignore template and create .gitignore
    ignore_text = requests.get("https://raw.githubusercontent.com/github/gitignore/refs/heads/main/Python.gitignore")
    if ignore_text.status_code == 200:
        with open(".gitignore", 'a') as f:
            f.write(ignore_text.text)
    os.chdir(current_dir)


# Create a benchmarks folder with tasks in them
def setup_task(tasks_path, task_name, task_path):

    print(f"Setting up {task_name}...", end='')
    task_folder = os.path.join(tasks_path, task_name)
    os.mkdir(task_folder) # TODO: check if folder exists and handle

    # Path could be absolute or relative, check and work accordingly
    if not task_path.startswith('/'):
        if task_path.startswith('./'):
            # TODO: Path could have one or more `../` use relpath to fix this block 
            task_path = task_path[2:]
        task_path = os.path.join(os.getcwd(), task_path)
        # print(f" path {task_path}\n\n") # Debugging
    
    #  could be a single file or a folder check and work accordignly
    if os.path.isdir(task_path):
        for sub in os.listdir(task_path):
            shutil.copy2(os.path.join(task_path, sub), task_folder)
    else:
        shutil.copy2(task_path, task_folder)
    print("Success")